# Connex - 高性能负载测试工具

## 项目简介

Connex是一款基于Rust开发的高性能负载测试工具，采用现代化的异步编程技术，支持高并发和详细的测试结果分析。

## 核心设计理念

1. **高性能优先**：利用Rust的零成本抽象和高效异步运行时，实现真正的高并发
2. **直接spawn + 无锁统计**：使用轻量级异步task和原子变量，避免内存爆炸和锁竞争
3. **异步全栈**：从HTTP客户端到结果统计，全异步设计，高效利用系统资源
4. **详细的错误统计**：分类统计不同类型的错误，便于问题定位

## 请求执行流程

### 核心执行逻辑

```rust
// 1. 创建指定数量的并发task
for _ in 0..config.concurrency {
    tokio::spawn(async move {
        // 2. 每个task持续发送请求直到测试结束
        while std::time::Instant::now() < end_time {
            // 3. 发送单个HTTP请求
            let response = client.get(url).send().await;
            
            // 4. 处理响应并更新统计
            match response {
                Ok(res) => {
                    // 使用AtomicU32更新成功计数
                    // 使用AtomicU64更新延迟统计
                }
                Err(e) => {
                    // 分类统计错误类型
                }
            }
        }
    });
}
```

### 设计特点

1. **多task并行**：根据配置的并发数生成相应数量的异步task
2. **单task串行**：每个task内部串行发送请求，符合真实用户行为
3. **无锁统计**：使用AtomicU32和AtomicU64代替Mutex，减少锁竞争
4. **高效异步IO**：充分利用Tokio的异步IO能力，提高吞吐量
5. **准确模拟负载**：每个task代表一个独立用户，准确模拟真实负载

## 性能表现

| 并发度 | RPS (每秒请求数) | 成功率 | 平均延迟 |
|--------|-----------------|--------|----------|
| 500    | 546.96          | 99.94% | 653ms    |

## 核心优势

### 1. 高性能高并发

- **轻量级task**：每个task仅占几KB内存，支持1000+并发
- **高效异步IO**：充分利用系统资源，获得高吞吐量
- **无锁统计**：避免高并发下的锁竞争，提高统计效率

### 2. 详细的测试结果

- **总请求数**：完整的请求计数
- **成功/失败请求数**：精确的成功率统计
- **每秒请求数(RPS)**：实时性能指标
- **平均延迟**：毫秒级延迟统计
- **错误分类统计**：连接错误、超时错误、HTTP错误、其他错误

### 3. 简单易用

- **简洁的Web界面**：只需输入URL即可执行测试
- **智能默认参数**：无需复杂设置
- **实时反馈**：控制台实时显示测试进度和结果

### 4. 可靠稳定

- **内存安全**：Rust的所有权模型，避免内存泄漏
- **并发安全**：使用原子操作，确保线程安全
- **详细的错误日志**：便于问题定位

## 测试建议

### 1. 合理设置并发数

| 场景 | 推荐并发数 | 说明 |
|------|------------|------|
| **基础性能测试** | 100-1000 | 获取服务的正常性能数据 |
| **极限性能测试** | 1000-10000 | 找到服务的性能拐点 |
| **稳定性测试** | 500-5000 | 长时间运行，验证稳定性 |
| **分布式系统测试** | 10000+ | 多节点环境下测试 |

### 2. 注意事项

- **本地测试**：避免超过10000并发，受限于硬件资源
- **外部服务测试**：注意目标服务的速率限制，避免触发封禁
- **观察错误率**：错误率超过5%时，应降低并发数
- **关注延迟变化**：延迟急剧上升通常意味着服务接近崩溃
- **使用稳定网络**：测试时避免网络波动影响结果

## 快速开始

### 1. 安装依赖

```bash
pnpm install
```

### 2. 开发模式

```bash
pnpm run dev
```

### 3. 构建生产版本

```bash
pnpm run build
```

### 4. 运行测试

```bash
cd src-tauri
cargo test
```

## 技术栈

- **前端**：SvelteKit + TypeScript
- **后端**：Rust + Tauri
- **HTTP客户端**：reqwest
- **异步运行时**：tokio
- **序列化**：serde

## 许可证

MIT License
